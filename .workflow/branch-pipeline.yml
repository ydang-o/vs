version: '1.0'
name: branch-pipeline
displayName: BranchPipeline
triggers:
  trigger: auto
  push:
    branches:
      include:
        - .*
      exclude:
        - master
variables:
  SERVER_HOST: 119.29.249.72
  SERVER_USER: ubuntu
  SERVER_SSH_KEY: |
    -----BEGIN OPENSSH PRIVATE KEY-----
    b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
    QyNTUxOQAAACDZpFSmHaByC+elt+N+LKJnrr2p3k0WTuwXF30gZ8juuQAAAJA4Lrx4OC68
    eAAAAAtzc2gtZWQyNTUxOQAAACDZpFSmHaByC+elt+N+LKJnrr2p3k0WTuwXF30gZ8juuQ
    AAAEC1I2htiDix71OjrfPzW220+F/CMyMMRxyFAJnc3jFvCtmkVKYdoHIL56W3434someu
    vaneTRZO7BcXfSBnyO65AAAACGdpdGVlLWNpAQIDBAU=
    -----END OPENSSH PRIVATE KEY-----
stages:
  - name: compile
    displayName: 编译
    strategy: naturally
    trigger: auto
    steps:
      - step: build@maven
        name: build_maven
        displayName: Maven 构建
        jdkVersion: 8
        mavenVersion: 3.3.9
        commands:
          - mvn -B clean package -Dmaven.test.skip=true
        artifacts:
          - name: BUILD_ARTIFACT
            path:
              - ./target
      - step: publish@general_artifacts
        name: publish_general_artifacts
        displayName: 上传制品
        dependArtifact: BUILD_ARTIFACT
        artifactName: output
        dependsOn: build_maven
  - name: release
    displayName: 发布
    strategy: naturally
    trigger: auto
    steps:
      - step: publish@release_artifacts
        name: publish_release_artifacts
        displayName: 发布
        dependArtifact: output
        version: 1.0.0.0
        autoIncrement: true
