<!--pages/index/index.wxml-->
<view class="container">
  <!-- Tabs -->
  <view class="tabs">
    <view class="tab-item {{currentTab === 0 ? 'active' : ''}}" bindtap="switchTab" data-index="0">全部</view>
    <view class="tab-item {{currentTab === 1 ? 'active' : ''}}" bindtap="switchTab" data-index="1">进行中</view>
    <view class="tab-item {{currentTab === 2 ? 'active' : ''}}" bindtap="switchTab" data-index="2">已结束</view>
  </view>

  <!-- Task List -->
  <scroll-view scroll-y class="task-list" refresher-enabled bindrefresherrefresh="onRefresh" refresher-triggered="{{refreshing}}">
    <view class="task-item card" wx:for="{{filteredTasks}}" wx:key="id" bindtap="goToDetail" data-id="{{item.id}}">
      <view class="task-header">
        <text class="task-id">NO.{{item.id}}</text>
        <view class="task-status {{item.status === 'published' ? 'status-active' : 'status-ended'}}">
          {{item.status === 'published' ? '进行中' : '已结束'}}
        </view>
      </view>
      
      <view class="task-title">{{item.title}}</view>
      
      <view class="task-info">
        <view class="info-row">
          <text class="label">截止时间：</text>
          <text class="value">{{item.deadline}}</text>
        </view>
        <view class="info-row">
          <text class="label">投票方式：</text>
          <text class="value">{{item.type}} | {{item.strategy}}</text>
        </view>
      </view>

      <view class="task-footer mt-md">
        <view class="progress-info">
          <text class="progress-text">已投 {{item.votedCount}}/{{item.totalCount}} 人</text>
        </view>
        <button class="btn btn-primary btn-sm" catchtap="goToDetail" data-id="{{item.id}}" wx:if="{{item.status === 'published'}}">
          立即投票
        </button>
        <button class="btn btn-outline btn-sm" catchtap="goToDetail" data-id="{{item.id}}" wx:else>
          查看结果
        </button>
      </view>
    </view>
    
    <view class="empty-state" wx:if="{{filteredTasks.length === 0}}">
      <text class="empty-text">暂无投票任务</text>
    </view>
    
    <view class="list-padding"></view>
  </scroll-view>
</view>
