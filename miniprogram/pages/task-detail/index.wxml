<!--pages/task-detail/index.wxml-->
<view class="container pb-footer">
  <!-- Header -->
  <view class="detail-header card">
    <view class="header-top">
      <text class="detail-id">NO.{{task.id}}</text>
      <text class="detail-status {{task.status === 'published' ? 'status-active' : 'status-ended'}}">{{task.status === 'published' ? '进行中' : '已结束'}}</text>
    </view>
    <view class="detail-title">{{task.title}}</view>
    <view class="detail-meta">
      <text class="meta-item">发布时间：2025-12-01</text>
      <text class="meta-item">发起人：系统管理员</text>
    </view>
  </view>

  <!-- Content -->
  <view class="content-section card">
    <view class="section-title">议案正文</view>
    <view class="rich-content">
      <text>{{task.content}}</text>
      <!-- Mock Rich Text Image -->
      <image class="content-img" src="/assets/placeholder.png" mode="widthFix" wx:if="{{false}}"></image>
    </view>
  </view>

  <!-- Vote Result (Visible if ended or voted) -->
  <view class="result-section card" wx:if="{{hasVoted || task.status === 'ended'}}">
    <view class="section-title">投票结果</view>
    <view class="result-list">
      <view class="result-item">
        <view class="result-label">
          <text>同意</text>
          <text>60%</text>
        </view>
        <progress percent="60" stroke-width="6" activeColor="#10B981" backgroundColor="#E5E7EB" border-radius="6" />
      </view>
      <view class="result-item">
        <view class="result-label">
          <text>反对</text>
          <text>20%</text>
        </view>
        <progress percent="20" stroke-width="6" activeColor="#EF4444" backgroundColor="#E5E7EB" border-radius="6" />
      </view>
      <view class="result-item">
        <view class="result-label">
          <text>弃权</text>
          <text>20%</text>
        </view>
        <progress percent="20" stroke-width="6" activeColor="#9CA3AF" backgroundColor="#E5E7EB" border-radius="6" />
      </view>
    </view>
    <view class="my-vote" wx:if="{{hasVoted}}">
      <text>您的投票：</text>
      <text class="vote-choice agree" wx:if="{{myVote === 'agree'}}">同意</text>
      <text class="vote-choice oppose" wx:if="{{myVote === 'oppose'}}">反对</text>
      <text class="vote-choice abstain" wx:if="{{myVote === 'abstain'}}">弃权</text>
    </view>
  </view>

  <!-- Action Bar -->
  <view class="footer-action" wx:if="{{task.status === 'published' && !hasVoted}}">
    <view class="deadline-tip">
      <text>距离截止还剩 12 小时</text>
    </view>
    <view class="action-buttons">
      <button class="btn btn-vote btn-agree" bindtap="handleVote" data-type="agree">同意</button>
      <button class="btn btn-vote btn-oppose" bindtap="handleVote" data-type="oppose">反对</button>
      <button class="btn btn-vote btn-abstain" bindtap="handleVote" data-type="abstain">弃权</button>
    </view>
    <view class="secondary-actions mt-sm">
      <view class="link-btn" bindtap="handleDelegate">委托投票</view>
    </view>
  </view>
</view>
